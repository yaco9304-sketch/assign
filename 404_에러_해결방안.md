# 404 에러 해결 방안

## 문제 상황
마감 버튼을 눌렀을 때 404 에러가 발생합니다.

## 원인 분석

### 1. 백엔드 엔드포인트 확인
- 백엔드 라우터: `router = APIRouter(prefix="/admin", tags=["admin"])`
- 엔드포인트: `@router.put("/preferences/close")`
- 실제 경로: `/admin/preferences/close` ✅

### 2. 프론트엔드 요청 확인
- 프론트엔드 코드: `api.put("/admin/preferences/close", payload)`
- 요청 경로: `/admin/preferences/close` ✅

### 3. 가능한 원인들

#### 원인 1: Render 서버 재배포 미완료
- 보안 강화 작업 후 Render 서버가 아직 재배포되지 않았을 수 있습니다.
- **해결방법**: Render 대시보드에서 배포 상태 확인 및 수동 재배포

#### 원인 2: 환경 변수 설정 문제
- 프론트엔드(Vercel)의 `VITE_API_BASE_URL` 환경 변수가 Render 백엔드 URL로 설정되지 않았을 수 있습니다.
- **해결방법**: Vercel 환경 변수 확인 및 설정

#### 원인 3: CORS 설정 문제
- 보안 강화 과정에서 CORS 설정이 변경되었을 수 있습니다.
- **해결방법**: Render의 `ALLOWED_ORIGINS` 환경 변수에 Vercel 프론트엔드 URL 추가

## 해결 단계

### 1단계: Render 서버 상태 확인
1. Render 대시보드 접속
2. 백엔드 서비스의 "Events" 탭 확인
3. 최신 배포가 완료되었는지 확인
4. 완료되지 않았다면 "Manual Deploy" 클릭

### 2단계: Vercel 환경 변수 확인
1. Vercel 대시보드 접속
2. 프로젝트 설정 → Environment Variables
3. `VITE_API_BASE_URL` 확인
4. 값이 Render 백엔드 URL인지 확인 (예: `https://your-backend.onrender.com`)

### 3단계: Render CORS 설정 확인
1. Render 대시보드 접속
2. 백엔드 서비스의 "Environment" 탭 확인
3. `ALLOWED_ORIGINS` 환경 변수 확인
4. Vercel 프론트엔드 URL이 포함되어 있는지 확인 (예: `https://assign-nu-weld.vercel.app`)

### 4단계: 브라우저 개발자 도구 확인
1. 브라우저 개발자 도구 열기 (F12)
2. Network 탭 확인
3. 마감 버튼 클릭
4. 실패한 요청 확인:
   - 요청 URL 확인
   - 응답 상태 코드 확인
   - 에러 메시지 확인

## 예상되는 정상 동작

### 요청
```
PUT https://your-backend.onrender.com/admin/preferences/close
Headers:
  Authorization: Bearer <token>
  Content-Type: application/json
Body:
  {
    "year": 2026,
    "is_closed": true
  }
```

### 응답
```
200 OK
{
  "year": 2026,
  "is_closed": true
}
```

## 추가 확인 사항

### 백엔드 로그 확인
Render 대시보드에서 백엔드 로그를 확인하여:
- 요청이 도달하는지 확인
- 에러 메시지 확인
- 404가 발생하는지 확인

### 네트워크 요청 확인
브라우저 개발자 도구 Network 탭에서:
- 실제 요청 URL 확인
- 요청이 전송되는지 확인
- CORS 에러가 발생하는지 확인

## 빠른 해결 방법

1. **Render 서버 수동 재배포**
   - Render 대시보드 → 백엔드 서비스 → "Manual Deploy" → "Deploy latest commit"

2. **환경 변수 재확인**
   - Vercel: `VITE_API_BASE_URL` = Render 백엔드 URL
   - Render: `ALLOWED_ORIGINS` = Vercel 프론트엔드 URL

3. **브라우저 캐시 클리어**
   - 브라우저 캐시 및 쿠키 삭제
   - 하드 리프레시 (Ctrl+Shift+R 또는 Cmd+Shift+R)

## 코드 수정 사항

이미 다음 수정이 완료되었습니다:
- ✅ `get_preference_status` 함수의 `is_closed` 변수 정의 누락 수정
- ✅ 백엔드 엔드포인트 경로 확인 (`/admin/preferences/close`)
- ✅ 프론트엔드 요청 경로 확인 (`/admin/preferences/close`)

변경사항이 GitHub에 푸시되었으므로, Render가 자동으로 재배포하면 해결될 것입니다.

