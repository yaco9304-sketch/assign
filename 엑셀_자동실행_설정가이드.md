# 엑셀 자동 실행 설정 가이드

## 📋 개요

엑셀 파일에서 버튼 클릭만으로 학년 배정을 자동으로 실행할 수 있도록 설정하는 방법입니다.

---

## 🚀 설정 방법

### 1단계: 템플릿 파일 생성

터미널에서 다음 명령어를 실행하세요:

```bash
python 학년배정_자동화.py --template 학년배정_템플릿.xlsx
```

이 명령어를 실행하면 `배정실행` 시트가 포함된 템플릿 파일이 생성됩니다.

---

### 2단계: VBA 매크로 추가

#### Windows에서:

1. **엑셀 파일 열기**
   - 생성된 `학년배정_템플릿.xlsx` 파일을 엑셀에서 엽니다.

2. **VBA 편집기 열기**
   - `Alt + F11` 키를 누르거나
   - 개발자 탭 → Visual Basic 클릭

3. **모듈 추가**
   - 왼쪽 프로젝트 탐색기에서 `VBAProject (학년배정_템플릿.xlsx)` 우클릭
   - 삽입 → 모듈 선택

4. **코드 붙여넣기**
   - `엑셀_자동실행.bas` 파일의 내용을 복사하여 새 모듈에 붙여넣기
   - 또는 `엑셀_자동실행.bas` 파일을 직접 가져오기:
     - 파일 → 파일 가져오기 → `엑셀_자동실행.bas` 선택

5. **저장**
   - `Ctrl + S` 또는 파일 → 저장
   - 매크로 포함 통합 문서로 저장하라는 메시지가 나오면 "예" 선택

#### macOS에서:

1. **엑셀 파일 열기**
   - 생성된 `학년배정_템플릿.xlsx` 파일을 엑셀에서 엽니다.

2. **VBA 편집기 열기**
   - `Option + F11` 키를 누르거나
   - 도구 → 매크로 → Visual Basic Editor

3. **모듈 추가**
   - 왼쪽 프로젝트 탐색기에서 `VBAProject (학년배정_템플릿.xlsx)` 우클릭
   - 삽입 → 모듈 선택

4. **코드 붙여넣기**
   - `엑셀_자동실행.bas` 파일의 내용을 복사하여 새 모듈에 붙여넣기

5. **저장**
   - `Cmd + S` 또는 파일 → 저장
   - 매크로 포함 통합 문서로 저장하라는 메시지가 나오면 "예" 선택

---

### 3단계: 버튼에 매크로 연결

#### 방법 1: 셀에 매크로 연결 (간단)

1. **배정실행 시트로 이동**
   - 엑셀 파일의 "배정실행" 시트를 엽니다.

2. **버튼 셀 선택**
   - "▶ 배정 실행" 버튼이 있는 셀(B12)을 선택합니다.

3. **매크로 연결**
   - 셀을 우클릭 → 하이퍼링크 삽입
   - 또는 개발자 탭 → 삽입 → 양식 컨트롤 → 버튼(양식 컨트롤) 선택
   - 버튼을 그린 후 매크로 대화상자에서 `배정실행` 선택

#### 방법 2: 개발자 탭 사용 (권장)

1. **개발자 탭 활성화**
   - 파일 → 옵션 → 리본 사용자 지정
   - 개발자 탭 체크 → 확인

2. **버튼 삽입**
   - 개발자 탭 → 삽입 → 양식 컨트롤 → 버튼(양식 컨트롤)
   - "배정실행" 시트의 적절한 위치에 버튼 그리기

3. **매크로 연결**
   - 버튼을 그리면 자동으로 매크로 대화상자가 열립니다.
   - `배정실행` 매크로를 선택하고 확인

4. **버튼 텍스트 변경**
   - 버튼을 우클릭 → 텍스트 편집
   - "배정 실행" 또는 원하는 텍스트 입력

---

## 🎯 사용 방법

### 1. 데이터 입력

1. **교사정보 시트**: 교사 기본 정보 입력
2. **희망사항 시트**: 교사별 희망 학년 입력 (선택)
3. **학년설정 시트**: 각 학년별 필요 담임 수 입력

### 2. 배정 실행

1. **배정실행 시트로 이동**
2. **배정 연도 확인/수정** (C10 셀)
3. **"배정 실행" 버튼 클릭**
4. **확인 대화상자에서 "예" 클릭**

### 3. 결과 확인

- **배정결과 시트**: 각 교사의 배정 학년과 배정 근거
- **학년별통계 시트**: 학년별 배정 인원 수
- **별도 결과 파일**: `원본파일명_배정결과_연도.xlsx` 파일도 자동 생성

---

## ⚙️ 고급 설정

### Python 경로 설정

VBA 매크로는 자동으로 Python을 찾지만, 찾지 못하는 경우:

1. **VBA 편집기 열기** (`Alt + F11` 또는 `Option + F11`)
2. **Module1 찾기**
3. **`pythonExe` 변수 수정**:

```vba
' 기본값
pythonExe = "python"

' Python 3를 사용하는 경우
pythonExe = "python3"

' 특정 경로를 사용하는 경우
pythonExe = "C:\Python39\python.exe"  ' Windows
pythonExe = "/usr/local/bin/python3"   ' macOS
```

### 스크립트 경로 설정

Python 스크립트가 엑셀 파일과 다른 위치에 있는 경우:

1. VBA 매크로 실행 시 경로 입력 대화상자가 나타납니다.
2. Python 스크립트의 전체 경로를 입력하세요.

또는 VBA 코드에서 직접 수정:

```vba
' 절대 경로로 지정
scriptPath = "C:\Users\사용자명\Desktop\xlsx\학년배정_자동화.py"  ' Windows
scriptPath = "/Users/사용자명/Desktop/xlsx/학년배정_자동화.py"     ' macOS
```

---

## 🔧 문제 해결

### ❌ 오류: "Python을 찾을 수 없습니다"

**해결 방법:**
1. Python이 설치되어 있는지 확인:
   ```bash
   python --version
   # 또는
   python3 --version
   ```

2. Python이 PATH에 등록되어 있는지 확인

3. VBA 코드에서 Python 경로를 직접 지정 (위의 "고급 설정" 참고)

### ❌ 오류: "스크립트 파일을 찾을 수 없습니다"

**해결 방법:**
1. `학년배정_자동화.py` 파일이 엑셀 파일과 같은 디렉토리에 있는지 확인

2. 또는 상위 디렉토리에 있는지 확인

3. 경로 입력 대화상자에서 전체 경로 입력

### ❌ 오류: "매크로가 실행되지 않습니다"

**해결 방법:**
1. **매크로 보안 설정 확인**
   - 파일 → 옵션 → 보안 센터 → 보안 센터 설정
   - 매크로 설정 → "모든 매크로 사용" 또는 "알림과 함께 매크로 사용" 선택

2. **파일 형식 확인**
   - `.xlsx` 형식은 매크로를 지원하지 않습니다.
   - `.xlsm` (매크로 포함 통합 문서) 형식으로 저장해야 합니다.
   - 파일 → 다른 이름으로 저장 → 파일 형식: "Excel 매크로 사용 통합 문서 (*.xlsm)"

### ❌ 오류: "배정 실행 시트가 없습니다"

**해결 방법:**
1. 템플릿 파일을 다시 생성:
   ```bash
   python 학년배정_자동화.py --template 학년배정_템플릿.xlsx
   ```

2. 또는 기존 파일에 배정 실행 시트 추가:
   - Python 스크립트를 수정하여 기존 파일에도 배정 실행 시트를 추가할 수 있습니다.

---

## 💡 팁

### 팁 1: 단축키 설정

VBA 편집기에서:
1. 도구 → 매크로 → 매크로
2. `배정실행` 선택
3. 옵션 클릭
4. 단축키 설정 (예: `Ctrl + Shift + A`)

이제 엑셀에서 `Ctrl + Shift + A`를 누르면 배정이 실행됩니다.

### 팁 2: 자동 새로고침

배정 실행 후 자동으로 결과 시트를 새로고침하려면 VBA 코드에 다음을 추가:

```vba
' 배정결과 시트로 이동 후 새로고침
ThisWorkbook.Sheets("배정결과").Activate
ThisWorkbook.RefreshAll
```

### 팁 3: 실행 로그 저장

Python 스크립트 실행 결과를 파일로 저장하려면 VBA 코드를 수정:

```vba
cmd = pythonExe & " """ & scriptPath & """ """ & excelPath & """ " & year & " > """ & excelDir & "\배정로그.txt"" 2>&1"
```

---

## 📝 참고사항

- **파일 형식**: 매크로를 사용하려면 `.xlsm` 형식으로 저장해야 합니다.
- **보안**: 매크로를 사용할 때는 보안 설정을 적절히 조정하세요.
- **백업**: 배정 실행 전에 원본 파일을 백업하는 것을 권장합니다.
- **Python 버전**: Python 3.6 이상이 필요합니다.

---

## 문의 및 지원

문제가 발생하거나 질문이 있으시면 개발팀에 문의해주세요.

