# 학년 배정 시스템 배포하기

## 가장 간단한 방법: Docker 사용 (추천)

### 1단계: Docker 설치 확인

터미널에서 다음 명령어 실행:
```bash
docker --version
docker-compose --version
```

만약 설치되어 있지 않다면:
- Mac: Docker Desktop 설치 (https://www.docker.com/products/docker-desktop)
- Windows: Docker Desktop 설치
- Linux: `sudo apt install docker.io docker-compose`

### 2단계: 환경 변수 파일 만들기

프로젝트 루트 폴더에 `.env` 파일을 만들고 다음 내용 입력:

```env
# 데이터베이스 비밀번호 (원하는 비밀번호로 변경)
DB_PASSWORD=my_secure_password_123

# 보안 키 (랜덤 문자열, 최소 32자)
SECRET_KEY=abcdefghijklmnopqrstuvwxyz1234567890

# 관리자 비밀번호
ADMIN_PASSWORD=admin1234

# 교사 비밀번호
TEACHER_PASSWORD=teacher1234

# Google OAuth (Google Cloud Console에서 받은 값)
GOOGLE_CLIENT_ID=your-google-client-id
GOOGLE_CLIENT_SECRET=your-google-client-secret
```

### 3단계: 배포 실행

프로젝트 루트 폴더에서:
```bash
docker-compose up -d --build
```

이 명령어가 하는 일:
- PostgreSQL 데이터베이스 실행
- 백엔드 서버 실행 (포트 8001)
- 프론트엔드 웹사이트 실행 (포트 80)

### 4단계: 확인

브라우저에서 `http://localhost` 접속하면 웹사이트가 보입니다.

---

## 서버에 배포하는 방법 (VPS, 클라우드 서버)

### 준비물
- 서버 (Ubuntu 20.04 이상 권장)
- 도메인 (선택사항, 없어도 IP로 접속 가능)

### 1단계: 서버 접속

```bash
ssh 사용자명@서버IP주소
```

### 2단계: 필요한 프로그램 설치

```bash
# 시스템 업데이트
sudo apt update && sudo apt upgrade -y

# Docker 설치
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh
sudo usermod -aG docker $USER

# Docker Compose 설치
sudo curl -L "https://github.com/docker/compose/releases/latest/download/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose

# 재로그인 (Docker 그룹 적용)
exit
# 다시 ssh로 접속
```

### 3단계: 프로젝트 파일 업로드

**방법 1: Git 사용 (추천)**
```bash
# 서버에서
cd ~
git clone your-repository-url assignment
cd assignment
```

**방법 2: 파일 전송 (scp 사용)**
```bash
# 로컬 컴퓨터에서
scp -r /Users/yaco/Desktop/xlsx 사용자명@서버IP:/home/사용자명/assignment
```

### 4단계: 환경 변수 설정

```bash
cd ~/assignment
nano .env
```

`.env` 파일 내용 입력 (위의 2단계 참고)

### 5단계: 배포 실행

```bash
docker-compose up -d --build
```

### 6단계: 방화벽 설정

```bash
# 포트 80 (웹사이트) 열기
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp  # HTTPS용
sudo ufw enable
```

### 7단계: 접속 확인

브라우저에서 `http://서버IP주소` 접속

---

## HTTPS 설정하기 (도메인이 있는 경우)

### 1단계: 도메인 DNS 설정

도메인 관리 페이지에서:
- A 레코드: `@` → 서버 IP 주소
- A 레코드: `www` → 서버 IP 주소

### 2단계: Nginx 설정 수정

`docker-compose.yml` 파일 수정:
```yaml
frontend:
  # ... 기존 설정 ...
  ports:
    - "80:80"
    - "443:443"
  volumes:
    - ./frontend/nginx.conf:/etc/nginx/conf.d/default.conf
    - ./certbot/conf:/etc/letsencrypt
    - ./certbot/www:/var/www/certbot
```

### 3단계: SSL 인증서 발급

```bash
# Certbot 설치
sudo apt install certbot

# 인증서 발급
sudo certbot certonly --standalone -d yourdomain.com -d www.yourdomain.com
```

### 4단계: Nginx에 SSL 설정 추가

`frontend/nginx.conf` 파일에 HTTPS 설정 추가

---

## 문제 해결

### "포트가 이미 사용 중입니다" 오류

```bash
# 포트 사용 중인 프로세스 확인
sudo lsof -i :80
sudo lsof -i :8001

# 프로세스 종료
sudo kill -9 [PID번호]
```

### "Docker 명령어를 찾을 수 없습니다"

Docker가 제대로 설치되었는지 확인:
```bash
docker --version
```

### "데이터베이스 연결 오류"

`.env` 파일의 `DB_PASSWORD`와 `docker-compose.yml`의 비밀번호가 일치하는지 확인

### 로그 확인

```bash
# 모든 서비스 로그
docker-compose logs

# 특정 서비스 로그
docker-compose logs backend
docker-compose logs frontend
docker-compose logs db
```

### 서비스 재시작

```bash
# 전체 재시작
docker-compose restart

# 특정 서비스만 재시작
docker-compose restart backend
```

### 서비스 중지

```bash
docker-compose down
```

### 완전히 삭제하고 다시 시작

```bash
# 모든 컨테이너와 데이터 삭제 (주의!)
docker-compose down -v

# 다시 시작
docker-compose up -d --build
```

---

## 자주 묻는 질문

**Q: 로컬에서 테스트하고 싶어요**
A: 위의 "가장 간단한 방법"을 따라하시면 `http://localhost`로 접속 가능합니다.

**Q: 서버에 배포했는데 접속이 안 돼요**
A: 
1. 서버 방화벽에서 포트 80이 열려있는지 확인
2. `docker-compose ps`로 서비스가 실행 중인지 확인
3. `docker-compose logs`로 오류 메시지 확인

**Q: 데이터베이스 데이터는 어디에 저장되나요?**
A: Docker volume에 저장됩니다. `docker-compose down -v`를 실행하면 삭제되니 주의하세요.

**Q: 코드를 수정했는데 반영이 안 돼요**
A: 
```bash
docker-compose restart backend  # 백엔드만 재시작
docker-compose restart frontend  # 프론트엔드만 재시작
```

**Q: 백업은 어떻게 하나요?**
A: 
```bash
# 데이터베이스 백업
docker-compose exec db pg_dump -U assignment_user assignment_db > backup.sql

# 복원
docker-compose exec -T db psql -U assignment_user assignment_db < backup.sql
```

---

## 다음 단계

배포가 완료되면:
1. 관리자 계정으로 로그인 테스트
2. 교사 계정으로 로그인 테스트
3. 엑셀 업로드 기능 테스트
4. 배정 실행 테스트

문제가 있으면 `docker-compose logs`로 로그를 확인하세요!



